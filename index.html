<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ƒê·ª´ng ƒê·ªÉ C·∫≠u V√†ng B·ªã B·∫Øt</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  background:#111;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
canvas{
  background:linear-gradient(#87ceeb,#fef3c7);
  border:5px solid #7c2d12;
}
</style>
</head>

<body>
<canvas id="game" width="1400" height="500"></canvas>

<script>
/* ======================
   KH·ªûI T·∫†O
====================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const W = canvas.width;
const H = canvas.height;

const GROUND = 380;
let speed = 7;
let gameOver = false;

/* ======================
   INPUT
====================== */
let jumpKey = false;
document.addEventListener("keydown",e=>{
  if(e.code==="Space") jumpKey = true;
});
document.addEventListener("keyup",e=>{
  if(e.code==="Space") jumpKey = false;
});
canvas.addEventListener("click",()=>jumpKey=true);

/* ======================
   C·∫¨U V√ÄNG
====================== */
const dog = {
  x:180,
  y:GROUND,
  w:90,
  h:60,
  vy:0,
  onGround:true,
  state:"run",
  t:0
};

/* ======================
   NH·∫¢Y CHU·∫®N DINO
====================== */
function updateDog(){
  if(jumpKey && dog.onGround){
    dog.vy = -18;
    dog.onGround = false;
    dog.state = "jump";
  }

  // gravity tƒÉng d·∫ßn (r∆°i nhanh)
  dog.vy += dog.vy < 0 ? 0.9 : 1.2;
  dog.y += dog.vy;

  if(dog.y >= GROUND){
    dog.y = GROUND;
    dog.vy = 0;
    dog.onGround = true;
    dog.state = "run";
  }

  dog.t += 0.25;
}

/* ======================
   V·∫º C·∫¨U V√ÄNG
====================== */
function drawDog(){
  ctx.save();
  ctx.translate(dog.x, dog.y);
  const run = Math.sin(dog.t);

  // th√¢n
  ctx.fillStyle="#fbbf24";
  ctx.beginPath();
  ctx.ellipse(0,0,45,28,0,0,Math.PI*2);
  ctx.fill();

  // ƒë·∫ßu
  ctx.beginPath();
  ctx.ellipse(55,-18,22,20,0,0,Math.PI*2);
  ctx.fill();

  // tai
  ctx.fillStyle="#f59e0b";
  ctx.beginPath();
  ctx.moveTo(48,-45); ctx.lineTo(35,-20); ctx.lineTo(55,-25); ctx.fill();
  ctx.beginPath();
  ctx.moveTo(62,-45); ctx.lineTo(55,-25); ctx.lineTo(75,-20); ctx.fill();

  // m·∫Øt
  ctx.fillStyle="#000";
  ctx.beginPath();
  ctx.arc(60,-20,3,0,Math.PI*2);
  ctx.fill();

  // ch√¢n
  ctx.strokeStyle="#92400e";
  ctx.lineWidth=5;
  if(dog.state==="run"){
    ctx.beginPath(); ctx.moveTo(20,20); ctx.lineTo(20,20+run*12); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(-20,20); ctx.lineTo(-20,20-run*12); ctx.stroke();
  }else{
    ctx.beginPath(); ctx.moveTo(20,20); ctx.lineTo(20,5); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(-20,20); ctx.lineTo(-20,5); ctx.stroke();
  }

  // ƒëu√¥i
  ctx.strokeStyle="#f59e0b";
  ctx.lineWidth=6;
  ctx.beginPath();
  ctx.moveTo(-45,-5);
  ctx.quadraticCurveTo(-65,-20+run*4,-55,-45);
  ctx.stroke();

  ctx.restore();
}

/* ======================
   CH∆Ø·ªöNG NG·∫†I T·∫æT
====================== */
let obstacles = [];

function spawnObstacle(){
  const type = Math.random()<0.5 ? "banh" : "phao";
  obstacles.push({
    type,
    x:W+40,
    w:type==="banh"?50:25,
    h:type==="banh"?40:70
  });
}
setInterval(spawnObstacle,1600);

/* ======================
   V·∫º CH∆Ø·ªöNG NG·∫†I
====================== */
function drawObstacle(o){
  if(o.type==="banh"){
    ctx.fillStyle="#166534";
    ctx.fillRect(o.x,GROUND+20,o.w,o.h);
  }else{
    ctx.fillStyle="#dc2626";
    ctx.fillRect(o.x,GROUND-10,o.w,o.h);
  }
}

/* ======================
   VA CH·∫†M
====================== */
function hit(o){
  return (
    dog.x+40 > o.x &&
    dog.x-40 < o.x+o.w &&
    dog.y+20 > GROUND+20-o.h
  );
}

/* ======================
   GAME LOOP
====================== */
function loop(){
  ctx.clearRect(0,0,W,H);

  // n·ªÅn + ƒë·∫•t
  ctx.fillStyle="#facc15";
  ctx.fillRect(0,GROUND+30,W,H);

  updateDog();
  drawDog();

  obstacles.forEach((o,i)=>{
    o.x -= speed;
    drawObstacle(o);

    if(hit(o)){
      gameOver = true;
    }
    if(o.x < -60) obstacles.splice(i,1);
  });

  if(gameOver){
    ctx.fillStyle="rgba(0,0,0,.7)";
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#fff";
    ctx.font="48px Arial";
    ctx.fillText("C·∫¨U V√ÄNG B·ªä B·∫ÆT üò≠",480,240);
    return;
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
