<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Xếp Hình Cùng CuMin</title>

<style>
body{
  margin:0;
  min-height:100vh;
  background:url("575243192_828061666267288_4525476926859105855_n.jpg") center/cover no-repeat;
  font-family:Arial;
  text-align:center;
}

/* TIÊU ĐỀ */
h2{
  color:#fff;
  text-shadow:2px 2px 8px #000;
  font-size:30px;
  margin-top:20px;
}

/* KHUNG GAME */
.board{
  display:inline-block;
  margin-top:20px;
  background:rgba(255,255,255,0.9);
  padding:30px 40px;
  border-radius:26px;
  box-shadow:0 15px 35px rgba(0,0,0,0.35);
}

.game{
  display:flex;
  justify-content:center;
  gap:40px;
}

/* SLOT */
.slot{
  width:110px;
  height:110px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#fff;
  border-radius:18px;
}

/* HÌNH KÉO */
.shape{
  width:100px;
  height:100px;
  position:absolute;
  cursor:pointer;
  touch-action:none;
  transition:0.15s;
}

.circle{background:#ff5252;border-radius:50%}
.square{background:#4caf50}
.triangle{
  background:#2196f3;
  clip-path:polygon(50% 0%,0% 100%,100% 100%);
}

/* RUNG KHI SAI */
@keyframes shake{
  0%,100%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  75%{transform:translateX(6px)}
}
</style>
</head>

<body>

<h2>Xếp Hình Cùng CuMin</h2>

<div class="board">
  <div class="game">
    <div class="slot" data-shape="circle">
      <svg width="100" height="100">
        <circle cx="50" cy="50" r="44" fill="none" stroke="#999" stroke-width="4"/>
      </svg>
    </div>

    <div class="slot" data-shape="square">
      <svg width="100" height="100">
        <rect x="6" y="6" width="88" height="88" fill="none" stroke="#999" stroke-width="4"/>
      </svg>
    </div>

    <div class="slot" data-shape="triangle">
      <svg width="100" height="100">
        <polygon points="50,6 6,94 94,94"
          fill="none" stroke="#999" stroke-width="4" stroke-linejoin="round"/>
      </svg>
    </div>
  </div>
</div>

<!-- HÌNH KÉO -->
<div class="shape circle" data-shape="circle" style="top:380px;left:120px"></div>
<div class="shape square" data-shape="square" style="top:380px;left:280px"></div>
<div class="shape triangle" data-shape="triangle" style="top:380px;left:440px"></div>

<!-- ÂM THANH -->
<audio id="soundWin" src="hello.mp3" preload="auto"></audio>

<script>
let active=null,ox=0,oy=0,startX=0,startY=0;
const SNAP_DISTANCE=60;

/* MỞ KHÓA ÂM THANH MOBILE */
let soundUnlocked=false;
function unlockSound(){
  if(soundUnlocked) return;
  const s=document.getElementById("soundWin");
  s.muted=true;
  s.play().then(()=>{
    s.pause(); s.currentTime=0; s.muted=false;
    soundUnlocked=true;
  }).catch(()=>{});
}
document.addEventListener("pointerdown",unlockSound,{once:true});

/* PHÁT ÂM THANH */
function playWinSound(){
  const s=document.getElementById("soundWin");
  s.currentTime=0;
  s.play().catch(()=>{});
}

/* KÉO THẢ */
document.querySelectorAll(".shape").forEach(s=>{
  s.addEventListener("pointerdown",e=>{
    active=s;
    ox=e.clientX-s.offsetLeft;
    oy=e.clientY-s.offsetTop;
    startX=s.style.left;
    startY=s.style.top;
    s.setPointerCapture(e.pointerId);
  });
});

document.addEventListener("pointermove",e=>{
  if(!active) return;
  active.style.left=e.clientX-ox+"px";
  active.style.top=e.clientY-oy+"px";
});

document.addEventListener("pointerup",()=>{
  if(!active) return;
  let ok=false;

  document.querySelectorAll(".slot").forEach(slot=>{
    const a=active.getBoundingClientRect();
    const b=slot.getBoundingClientRect();
    const d=Math.hypot((a.left+50)-(b.left+50),(a.top+50)-(b.top+50));
    const outline=slot.querySelector("*");

    if(d<SNAP_DISTANCE){
      if(slot.dataset.shape===active.dataset.shape){
        active.style.left=b.left+"px";
        active.style.top=b.top+"px";
        outline.setAttribute("stroke","#4caf50");
        playWinSound();
        ok=true;
      }else{
        outline.setAttribute("stroke","#f44336");
      }
    }
  });

  if(!ok){
    active.style.animation="shake 0.3s";
    active.style.left=startX;
    active.style.top=startY;
    setTimeout(()=>active.style.animation="",300);
  }
  active=null;
});
</script>

</body>
</html>
